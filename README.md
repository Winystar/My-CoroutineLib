# My-CoroutineLib
本项目是对sylar服务器框架的改编和简化，专注于协程库部分。通过引入协程、调度器和定时器模块，使用hook技术将Linux中同步版本的系统函数（如：sleep，read， write）转化为异步版本，以提升函数异步执行的效率和响应时间。
## 运行环境
Ubantu 22.04.4 amd64
## 编译指令
* 首先进入文件所在目录
  ```cpp
  cd My-CoroutineLib && cd 6hook
  ```
* 在6hook文件下编译链接可执行文件
  ```cpp
  g++ *.cpp -std=c++17 -o main -ldl -lpthread
  ```
* 执行可执行文件
  ```cpp
  ./main
  ```
* 如图
  
## 测试
* 使用apache工具进行测试
  ```cpp
  ab -n 100000 -c 100  http://127.0.0.1:8080/
  ```
* 如图

## 模块介绍
### 协程类
* 使用非对称的独立栈协程
* 支持调度协程和任务协程之间的高效切换
### 调度器
* 结合线程池和任务队列维护任务
* 采用FIFO策略运行协程任务，并负责将epoll中就绪的文件描述符和超时任务加入队列
### 定时器
* 利用最小堆算法管理定时器，优化超时回调函数的获取效率
## 待优化和可扩展功能
### 内存池优化
当前协程在创建时会自动分配独立栈空间，协程被销毁时释放，这引入了频繁的系统调用。可以通过内存池技术优化来减少系统调用，提高内存使用效率。
### 协程嵌套支持
目前仅支持主协程和子协程之间的切换，无法实现协程的嵌套。可以参考libco的设计，允许在协程内部再次创建新的协程层级。
### 更复杂的任务调度算法
可以引入类似操作系统的进程调度算法，如优先级、响应比和时间片，以支持更复杂的调度策略，满足不同场景下的需求。
## HOOK技术
对系统底层函数进行封装，增强功能且保持原有调用接口的兼容性，使函数在保持原有调用方式的同时，增加新的功能实现。
  
  

  
